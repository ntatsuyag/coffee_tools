import Head from 'next/head'
import React, { useState } from 'react'
import {
  Button,
  Container,
  Divider,
  Group,
  NumberInput,
  Paper,
  Slider,
  Stack,
  Text,
  Title,
} from '@mantine/core'

const presetWeights = [15, 20, 25, 30, 40]

const brewSteps: Array<{ label: string; multiplier: number; increment?: number }> = [
  { label: '1ãƒ‰ãƒªãƒƒãƒ—ç›®', multiplier: 0.15 },
  { label: '2ãƒ‰ãƒªãƒƒãƒ—ç›®', multiplier: 0.3, increment: 0.15 },
  { label: '3ãƒ‰ãƒªãƒƒãƒ—ç›®', multiplier: 0.45, increment: 0.15 },
  { label: '4ãƒ‰ãƒªãƒƒãƒ—ç›®', multiplier: 0.7, increment: 0.25 },
  { label: '5ãƒ‰ãƒªãƒƒãƒ—ç›®', multiplier: 1, increment: 0.3 },
]

const formatWeight = (value: number) => (Number.isFinite(value) ? Math.round(value * 10) / 10 : 0)

export default function Home() {
  const [calcGram, setCalcGram] = useState(0)
  const [coffeeGram, setCoffeeGram] = useState(0)
  const [ratio, setRatio] = useState(15)

  const handleCoffeeChange = (value: number | string) => {
    const parsedValue = typeof value === 'number' ? value : Number(value)
    setCoffeeGram(Number.isFinite(parsedValue) ? parsedValue : 0)
  }

  const handlePresetSelect = (value: number) => {
    setCoffeeGram(value)
  }

  const handleRatioChange = (value: number) => {
    setRatio(Math.round(value))
  }

  const handleCalculationGram = () => {
    setCalcGram(coffeeGram * ratio)
  }

  const totalWater = calcGram

  return (
    <>
      <Head>
        <title>Coffee tools</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/coffee.png" />
      </Head>

      <Container size="sm" py="xl">
        <Stack gap="xl">
          <Stack gap="xs" align="center">
            <Title order={1} c="var(--mantine-color-coffee-7)">
              â˜•ï¸ Coffee tools
            </Title>
            <Text c="var(--mantine-color-coffee-6)">æ‰‹è»½ã«ãƒ‰ãƒªãƒƒãƒ—ãƒ¬ã‚·ãƒ”ã‚’è¨ˆç®—ã—ã¾ã—ã‚‡ã†ã€‚</Text>
          </Stack>

          <Paper withBorder shadow="md" radius="lg" p="xl" bg="var(--mantine-color-coffee-0)">
            <Stack gap="md">
              <Title order={2} c="var(--mantine-color-coffee-8)">
                5å›æŠ½å‡ºã®æ°´é‡è¨ˆç®—ãƒ„ãƒ¼ãƒ«
              </Title>
              <Text size="sm">ã‚³ãƒ¼ãƒ’ãƒ¼ã®é‡ã• (g) ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ã€‚</Text>

              <NumberInput
                label="ã‚³ãƒ¼ãƒ’ãƒ¼ã®é‡ã• (g)"
                min={0}
                hideControls
                value={coffeeGram}
                onChange={handleCoffeeChange}
                placeholder="ä¾‹: 20"
              />

              <Group gap="xs" wrap="wrap">
                {presetWeights.map((weight) => (
                  <Button
                    key={weight}
                    variant={coffeeGram === weight ? 'filled' : 'light'}
                    onClick={() => handlePresetSelect(weight)}
                    size="sm"
                  >
                    {weight} g
                  </Button>
                ))}
              </Group>

              <Button onClick={handleCalculationGram} disabled={coffeeGram <= 0} size="md">
                è¨ˆç®—
              </Button>
              <Text size="sm" c="var(--mantine-color-coffee-6)">
                ã‚³ãƒ¼ãƒ’ãƒ¼:æ°´ = 1:{ratio} ã®å‰²åˆã§æ°´é‡ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
              </Text>

              <Divider label="ãƒ¬ã‚·ãƒ”" labelPosition="center" />
              <Stack gap="sm">
                <Text fw={600}>å…¨æ°´é‡: {formatWeight(totalWater)} g</Text>
                {brewSteps.map(({ label, multiplier, increment }) => {
                  const amount = formatWeight(totalWater * multiplier)
                  const incrementText =
                    typeof increment === 'number'
                      ? ` (+${formatWeight(totalWater * increment)}g)`
                      : ''
                  return (
                    <Text key={label}>
                      {label}: {amount} g{incrementText}
                    </Text>
                  )
                })}
              </Stack>
            </Stack>
          </Paper>

          <Paper withBorder shadow="sm" radius="lg" p="xl" bg="var(--mantine-color-coffee-1)">
            <Stack gap="md">
              <Title order={2}>ğŸ”§ è¨­å®š</Title>
              <Text size="sm">ã‚³ãƒ¼ãƒ’ãƒ¼ã®é‡ã• (g) ã«å¯¾ã™ã‚‹æ°´é‡ã®å‰²åˆã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</Text>

              <Stack gap="xs">
                <Group justify="space-between" align="center">
                  <Text size="sm" fw={500}>
                    å‰²åˆ (1:n)
                  </Text>
                  <Text fw={600}>{ratio}</Text>
                </Group>
                <Slider
                  min={1}
                  max={20}
                  step={1}
                  marks={[
                    { value: 5, label: '5' },
                    { value: 10, label: '10' },
                    { value: 15, label: '15' },
                    { value: 20, label: '20' },
                  ]}
                  value={ratio}
                  onChange={handleRatioChange}
                />
              </Stack>
            </Stack>
          </Paper>

          <Text ta="center" c="dimmed">
            ğŸ¤ enjoy your coffee time ğŸ¤
          </Text>
        </Stack>
      </Container>
    </>
  )
}
